---
name: YAML Lint

on:
  push:
    branches: [main]
    paths:
      - "**.yaml"
      - "**.yml"
      - ".yamllint"
  pull_request:
    branches: [main]
    paths:
      - "**.yaml"
      - "**.yml"
      - ".yamllint"

jobs:
  yamllint-changed:
    name: Lint changed YAML files
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install yamllint
        run: pip install yamllint

      - name: Get changed YAML files
        id: changed
        run: |
          FILES=$(git diff --name-only --diff-filter=ACMR origin/${{ github.base_ref }}...HEAD -- '*.yaml' '*.yml')
          if [ -z "$FILES" ]; then
            echo "No YAML files changed."
            echo "files=" >> "$GITHUB_OUTPUT"
          else
            echo "Changed YAML files:"
            echo "$FILES"
            echo "files=$FILES" >> "$GITHUB_OUTPUT"
          fi

      - name: Run yamllint on changed files
        if: steps.changed.outputs.files != ''
        run: echo "${{ steps.changed.outputs.files }}" | xargs yamllint -c .yamllint

  yamllint-all:
    name: Lint all YAML files
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    continue-on-error: true
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install yamllint
        run: pip install yamllint

      - name: Run yamllint
        run: yamllint -c .yamllint .
